:numbered:
:toc: macro
:sectanchors:

:BACK_TO_TOP_TARGET: back-to-top
:BACK_TO_TOP_LABEL: ⬆ Retourner au sommaire
:BACK_TO_TOP: <<{BACK_TO_TOP_TARGET},{BACK_TO_TOP_LABEL}>>

[#{BACK_TO_TOP_TARGET}]
= Arduino & TDD avec Google Test

:toc-title: Sommaire
:toclevels: 3
toc::[]

'''

{BACK_TO_TOP}

== Coder et tester en C++

=== Installer C++

```bash
$ sudo apt-get install g++
```

{BACK_TO_TOP}

=== Installer Google Test

==== Installer GTest et Gmock

```bash
sudo apt-get install libgtest-dev
sudo apt-get install cmake
```

==== Configurer GTest

```bash
cd /usr/src/googletest/googletest
sudo mkdir build

cd build
sudo cmake ..
sudo make
sudo cp libgtest* /usr/lib/

cd ..
sudo rm -rf build

sudo mkdir /usr/local/lib/googletest
sudo ln -s /usr/lib/libgtest.a /usr/local/lib/googletest/libgtest.a
sudo ln -s /usr/lib/libgtest_main.a /usr/local/lib/googletest/libgtest_main.a
```

==== Configurer GMock

```bash
cd /usr/src/googletest/googlemock
sudo cmake CMakeLists.txt 
sudo make

sudo cp *.a /usr/lib
sudo cp gtest/*.a /usr/lib

sudo cp -r include/gmock /usr/include/
sudo cp -r ../googletest/include/gtest/ /usr/include/
```

==== Vérifier que tous les fichiers soient bien présents

```bash
$ ls /usr/lib | grep -i -E -e=\*\\.a$
# ... ou ...
$ ls /usr/lib | grep -i -E -e="*\.a$"
libgmock.a
libgmock_main.a
libgtest.a
libgtest_main.a

$ ls /usr/include/ | grep gmock
gmock

$ ls /usr/include/ | grep gtest
gtest
```

{BACK_TO_TOP}

== Utiliser cette toolbox

=== Cloner le repo

```bash
git clone git@github.com:jprivet-dev/arduino-googletest-toolbox.git
cd arduino-googletest-toolbox
```

{BACK_TO_TOP}

=== Initialiser & Exécuter les tests

A partir du dossier du repo cloné `arduino-googletest-toolbox`

```bash
cd arduino-project/tests
cmake CMakeLists.txt
make
./runTests
```

Le test affichera un message du type :

```bash
[==========] Running 7 tests from 4 test cases.
[----------] Global test environment set-up.
[----------] 2 tests from SquareRootTest
[ RUN      ] SquareRootTest.PositiveNos
[       OK ] SquareRootTest.PositiveNos (0 ms)
[ RUN      ] SquareRootTest.NegativeNos
[       OK ] SquareRootTest.NegativeNos (0 ms)
[----------] 2 tests from SquareRootTest (1 ms total)

[----------] 2 tests from MyClassTest
[ RUN      ] MyClassTest.get_id
[       OK ] MyClassTest.get_id (0 ms)
[ RUN      ] MyClassTest.increment_by_5
[       OK ] MyClassTest.increment_by_5 (0 ms)
[----------] 2 tests from MyClassTest (0 ms total)

[----------] 2 tests from MyClassWithSetupTest
[ RUN      ] MyClassWithSetupTest.get_id
[       OK ] MyClassWithSetupTest.get_id (0 ms)
[ RUN      ] MyClassWithSetupTest.increment_by_5
[       OK ] MyClassWithSetupTest.increment_by_5 (0 ms)
[----------] 2 tests from MyClassWithSetupTest (0 ms total)

[----------] 1 test from SubjectTestSetup
[ RUN      ] SubjectTestSetup.get_name
[       OK ] SubjectTestSetup.get_name (0 ms)
[----------] 1 test from SubjectTestSetup (0 ms total)

[----------] Global test environment tear-down
[==========] 7 tests from 4 test cases ran. (1 ms total)
[  PASSED  ] 7 tests.
```

{BACK_TO_TOP}

== Activer les raccourcis

La ligne de commande suivante :

```bash
cd arduino-project/tests
$ . .bash_aliases
```

Activera les raccourcis suivants :

```
alias cm="cmake CMakeLists.txt"
alias m="make"
alias t="./runTests"
```

{BACK_TO_TOP}

== Resources

=== GoogleTest

* https://github.com/google/googletest
* How To Install/Use Google C++ Test Framework - https://www.srcmake.com/home/google-cpp-test-framework
* Google C++ Testing, GTest, GMock Framework - https://www.youtube.com/watch?v=nbFXI9SDfbk&list=PL_dsdStdDXbo-zApdWB5XiF2aWpsqzV55
* https://packages.debian.org/fr/sid/libgtest-dev

=== Google Mock

* https://github.com/google/googlemock
* https://fr.slideshare.net/LuisGoldster/google-mock-for-dummies-61427788
* https://github.com/google/googletest/issues/1602
* https://github.com/google/googlemock/blob/master/googlemock/CMakeLists.txt
* https://github.com/pauloremoli/cmake-gtest-gmock
* https://stackoverflow.com/questions/36086037/cant-build-c-c-program-with-gmock-gmock-h-too-many-errors-are-generated
* https://packages.debian.org/sid/libgmock-dev
* https://github.com/maitesin/blog/tree/master/google_mock_2016_01_22

{BACK_TO_TOP}
